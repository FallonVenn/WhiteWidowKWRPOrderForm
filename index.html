<!DOCTYPE html>
<html>
<head>
  <title>KWRP White Widow POS</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<img src="image.png" alt="KWRP White Widow Logo" width="150">
  <h1>KWRP White Widow POS</h1>

  <h2>Order Entry</h2>

Employee:
<select id="employee" name="employee" required>
  <option value="">Select Employee</option>
  <option>Daniel Taylor</option>
  <option>Jeremy Cobain</option>
  <option>Lucie Asmodeus</option>
  <option>Thomas White</option>
  <option>Fallon Graves</option>
  <option>Benny Pegorino</option>
</select>
<br><br>

Buyer:
<input id="buyer" name="buyer" placeholder="Enter buyer name" required>
<br><br>

Item:
<select id="item" onchange="toggleTabPaymentItem()">
  <option value="White Widow 2g Bag" data-price="1500">White Widow 2g Bag - $1500 per</option>
  <option value="White Widow Joint" data-price="1800">White Widow Joint - $1800 per</option>
  <option value="Strawberry Gummy Bears" data-price="2000">Strawberry Gummy Bears - $2000 per</option>
  <option value="AK-47 Cookies" data-price="2000">AK-47 Cookies - $2000 per</option>
  <option value="TAB_PAYMENT" data-price="0">Tab Payment - Custom Amount</option>
</select>

<span id="qtyLabel">Qty:</span>
<input id="qty" type="number" value="1" min="1">

<span id="tabAmountLabel" style="display:none;">Amount to Add to Tab:</span>
<input id="tabPaymentAmount" type="number" min="1" style="display:none;" placeholder="Enter dollar amount">

<button onclick="addItem()">Add to Cart</button>

<h3>Cart</h3>
<ul id="cart"></ul>

<h3>Total: $<span id="total">0</span></h3>

Payment:
<select id="payment" name="paymentType" required onchange="toggleTabField()">
  <option value="" disabled selected>Select Payment</option>
  <option value="Cash">Cash</option>
  <option value="Card">Card</option>
  <option value="Tab">Tab</option>
</select>

<div id="tabBlock" style="display:none;">
  Tab:
  <select id="tabSelect" name="tabSelect" onchange="toggleNewTabField()">
    <option value="">Select Tab</option>
    <option value="NEW">New Tab</option>
  </select>
</div>

<div id="newTabBlock" style="display:none;">
  New Tab Name:
  <input id="newTabName" placeholder="Enter new tab name">
</div>
<br>

<!-- Hidden form for Apps Script submission -->
<form id="orderForm" action="https://script.google.com/macros/s/AKfycby_CYPk1QyM0zOU0AFI83N7xCKPmVlgFjkstwD-lLh3sm_pGJ765SwLAvGhdCbuSobn/exec" method="post" target="hiddenIframe">
  <input type="hidden" name="data" id="formData">
</form>
<iframe name="hiddenIframe" style="display:none;"></iframe>

<button type="button" onclick="submitOrder()">Submit Order</button>

<script>
let cart = [];
let total = 0;

/* ===============================
   TAB PAYMENT VISIBILITY
================================ */
function toggleTabPaymentItem() {
  const itemValue = document.getElementById("item").value;
  const qtyField = document.getElementById("qty");
  const qtyLabel = document.getElementById("qtyLabel");
  const tabAmountField = document.getElementById("tabPaymentAmount");
  const tabAmountLabel = document.getElementById("tabAmountLabel");

  if (itemValue === "TAB_PAYMENT") {
    qtyField.style.display = "none";
    qtyLabel.style.display = "none";
    qtyField.value = 1;

    tabAmountField.style.display = "inline-block";
    tabAmountLabel.style.display = "inline-block";
    tabAmountField.required = true;
  } else {
    qtyField.style.display = "inline-block";
    qtyLabel.style.display = "inline-block";

    tabAmountField.style.display = "none";
    tabAmountLabel.style.display = "none";
    tabAmountField.required = false;
    tabAmountField.value = "";
  }
}

/* ===============================
   TAB SELECTION LOGIC
================================ */
function toggleTabField() {
  const payment = document.getElementById("payment").value;
  const tabBlock = document.getElementById("tabBlock");
  const newTabBlock = document.getElementById("newTabBlock");
  const tabSelect = document.getElementById("tabSelect");
  const newTabField = document.getElementById("newTabName");

  if (payment === "Tab") {
    tabBlock.style.display = "block";
    tabSelect.required = true;
  } else {
    tabBlock.style.display = "none";
    newTabBlock.style.display = "none";
    tabSelect.required = false;
    tabSelect.value = "";
    newTabField.value = "";
  }
}

function toggleNewTabField() {
  const tabSelect = document.getElementById("tabSelect").value;
  const newTabBlock = document.getElementById("newTabBlock");
  const newTabField = document.getElementById("newTabName");

  if (tabSelect === "NEW") {
    newTabBlock.style.display = "block";
    newTabField.required = true;
  } else {
    newTabBlock.style.display = "none";
    newTabField.required = false;
    newTabField.value = "";
  }
}

/* ===============================
   ADD ITEM
================================ */
function addItem() {
  const itemSelect = document.getElementById("item");
  const qty = Number(document.getElementById("qty").value);
  const itemValue = itemSelect.value;
  const itemText = itemSelect.selectedOptions[0].text;

  let price = Number(itemSelect.selectedOptions[0].dataset.price);
  let lineTotal = 0;
  let name = itemText;

  if (itemValue === "TAB_PAYMENT") {
    const amount = Number(document.getElementById("tabPaymentAmount").value);
    if (!amount || amount <= 0) { alert("Enter amount to add to tab."); return; }
    price = amount;
    lineTotal = amount;
    name = "Tab Payment";
  } else {
    if (qty <= 0) { alert("Quantity must be at least 1."); return; }
    lineTotal = price * qty;
  }

  total += lineTotal;

  cart.push({
    name,
    qty: itemValue === "TAB_PAYMENT" ? 1 : qty,
    price,
    lineTotal,
    isTabPayment: itemValue === "TAB_PAYMENT"
  });

  document.getElementById("cart").innerHTML +=
    `<li>${name} = $${lineTotal}</li>`;
  document.getElementById("total").textContent = total;

  document.getElementById("tabPaymentAmount").value = "";
}

/* ===============================
   SUBMIT ORDER (FORM METHOD)
================================ */
function submitOrder() {
  if (cart.length === 0) {
    alert("Cart is empty!");
    return;
  }

  let tabNameFinal = "";
  if (document.getElementById("payment").value === "Tab") {
    const tabChoice = document.getElementById("tabSelect").value;
    if (tabChoice === "NEW") {
      tabNameFinal = document.getElementById("newTabName").value.trim();
      if (!tabNameFinal) { alert("Enter new tab name."); return; }
    } else {
      tabNameFinal = tabChoice;
    }
  }

  const payload = {
    employee: document.getElementById("employee").value,
    buyer: document.getElementById("buyer").value,
    paymentType: document.getElementById("payment").value,
    tabName: tabNameFinal,
    cart: cart,
    total: total
  };

  // âœ… Submit via hidden form (works with Apps Script, avoids CORS)
  document.getElementById("formData").value = JSON.stringify(payload);
  document.getElementById("orderForm").submit();

  alert("Order submitted!");

  // reset POS
  cart = [];
  total = 0;
  document.getElementById("cart").innerHTML = "";
  document.getElementById("total").textContent = "0";
}
</script>

</body>
</html>
